---
title: "Назначение"
description: "Какие задачи решает проект"
date: 2020-01-28T00:34:51+09:00
draft: false
weight: 1
---

## Зачем это нужно

Цель создания dcape - получить относительно удобный способ запуска docker-приложений простой короткой командой, например

* `make up` - локально
* `git push` - удаленно

Главная проблема была в том, как повесить несколько контейнеров на порт 80, чтобы запросы к ним проксировались по имени хоста не на основании заранее руками созданного конфига, а по факту старта контейнера - эту задачу решил [traefik](https://traefik.io/).
Бонусом он добавил TLS, т.е. возможность получения сертификата для хоста или, когда хостов много - для домена (т.е. wildcard-домена)

При использовании `traefik` приложение может управлять своей доступностью извне посредством меток (label) docker-контейнера, задавать которые можно в файле `docker-compose.yml`

Проект dcape - это попытка достичь требуемых целей с помощью `traefik`, `docker-compose` и минимального количества дополнительного кода.

## Как это выглядит

Развертывание **dcape** имеет результатом 2 файла - `docker-compose.yml` и `.env`, которые позволяют командой `make up` запустить весь стек выбранных для конкретного сервера приложений. Все эти приложения доступны на [dockerhub](https://hub.docker.com/) и все нужное для их запуска командой `docker-compose up` может быть подготовлено вручную, однако **dcape** добавляет в процесс подготовки такого решения следующие преимущества:

* файл параметров (`.env`) формируется программно, что позволяет
  * использовать в значениях переменные
  * генерировать необходимые приложениям пароли и токены
  * формировать взаимосвязанные настройки приложений
* файл конфигурации контейнеров (`docker-compose.yml`) формируется программно, что позволяет параметризовать список приложений для каждой инсталляции, в частности
  * если разворачивается группа серверов различного назначения, gitea достаточно развернуть только на одном из них, а на остальных вместо `make init` выполнять `make init GITEA=https://git.domain.tld`
  * если для сервера не нужен SSL (например, в локальной сети), не указывать параметр `ACME`
  * если для сервера не нужен DNS (например, wildcard сертификаты не используются или их поддержка не использует локальный DNS), не указывать параметр `DNS`
* использование `make` позволяет перед стартом приложения выполнять его инициализацию, включая
  * создание БД (и, при необходимости, загрузку дампа БД)
  * формирование файлов конфигураций по шаблонам
  * регистрацию OAuth2 приложений
