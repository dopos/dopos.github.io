---
title: "postgresql"
date: 2020-01-30T00:38:25+09:00
description: хранение конфигураций всех приложений и размещение баз данных приложений, которым требуется СУБД
draft: false
weight: 2
---

 Приложение |  [postgresql](https://www.postgresql.org)
 -- | --
 Docker | [image](https://hub.docker.com/_/postgres)
 Назначение | хранение конфигураций всех приложений и размещение баз данных приложений, которым требуется СУБД

## Назначение

СУБД postgresql используется следующими сервисами dcape:

* gitea
* drone
* enfist
* powerdns

Кроме этого, контейнер доступен для других приложений, развертываемых под dcape.

## Особенности

### Размещение файлов

Постоянные данные контейнера размещаются в каталоге `var/db` в следующих подкаталогах:

* `data` - внутренние файлы postgresql
* `init` - скрипты, которые выполняются при старте контейнера
* `backup` - размещение дампов баз для импорта/экспорта
* `conf.d` - каталог дополнений в конфигурацию, активируется вручную параметром `include_dir` файла `postgresql.conf`
* `shared` - каталог для размещения расширений перед их ручной активацией

### Резервные копии

Для резервного копирования баз данных используется приложение [pg-backup](https://github.com/dopos/dcape-app-pg-backup) которое ежедневно (по крону) делает дампы указанных в настройка баз и размещает их в формате `.tgz` в каталоге `var/db/backup`

## Пример использования

Пример приложения, использующего postgresql - [dcape-app-mattermost](https://github.com/dopos/dcape-app-mattermost)

В файле [Makefile](https://github.com/dopos/dcape-app-mattermost/blob/master/Makefile) к СУБД относятся следующие цели:

* `docker-wait` - ожидание запуска контейнера postgresql и готовности СУБД
* `db-create` - создание пользователя и БД, после создания БД - импорт дампа, если он задан в настройках
* `db-drop` - удаление БД и пользователя
* `psql` - запуск psql из запущенного контейнера postgresql c присоединением к БД приложения
