<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>dopos</title><link>https://dopos.github.io/en/</link><description>Recent content on dopos</description><generator>Hugo -- gohugo.io</generator><language>en</language><copyright>&amp;copy;{year}, All Rights Reserved</copyright><lastBuildDate>Sat, 11 Jan 2020 14:09:21 +0900</lastBuildDate><atom:link href="https://dopos.github.io/en/index.xml" rel="self" type="application/rss+xml"/><item><title>November 2020</title><link>https://dopos.github.io/en/updates/2020_november/</link><pubDate>Fri, 11 Aug 2017 00:10:37 +0900</pubDate><guid>https://dopos.github.io/en/updates/2020_november/</guid><description>Github: dcape
Release: v1.1, Two years in production</description></item><item><title>September 2018</title><link>https://dopos.github.io/en/updates/2018_september/</link><pubDate>Fri, 11 Aug 2017 00:10:37 +0900</pubDate><guid>https://dopos.github.io/en/updates/2018_september/</guid><description>v1.0.0-rc2 (2018-09-23) Github: dcape
Release: v1.0.0-rc2, Use apisite
Изменено apps/enfist: вместо pgrpc теперь используется apisite Установка обновления git pull mv .env .env.bak make init make enfist-apply make up</description></item><item><title>October 2017</title><link>https://dopos.github.io/en/updates/2017_october/</link><pubDate>Fri, 11 Aug 2017 00:10:37 +0900</pubDate><guid>https://dopos.github.io/en/updates/2017_october/</guid><description>v1.0.0-rc1 Date: 2017-10-22
Github: dcape
Release: v1.0.0-rc1, Ready to use
Изменено apps/traefik*: в настройки вынесен редирект 80 -&amp;gt; 443 apps/traefik теперь не совместим по конфигу с apps/traefik-acme, при переключении необходим make init v0.10 Date: 2017-10-19
Изменено apps/cis: добавлено создание каталогов var/apps, var/log в cis-apply apps/cis: изменена версия webtail (0.12) apps/enfist: исправлено обновление sql-пакетов enfist,rpc и их текущие версии Добавлено Файл CHANGELOG.md README.md: информация о зависимости (gawk), уточнен блок &amp;ldquo;Быстрый старт&amp;rdquo; DEPLOY.</description></item><item><title>August 2017</title><link>https://dopos.github.io/en/updates/2017_august/</link><pubDate>Fri, 11 Aug 2017 00:10:37 +0900</pubDate><guid>https://dopos.github.io/en/updates/2017_august/</guid><description>Github: dcape
Commit: v0.1, code working in general</description></item><item><title>February 2015</title><link>https://dopos.github.io/en/updates/2015_february/</link><pubDate>Tue, 28 Jan 2020 00:10:37 +0900</pubDate><guid>https://dopos.github.io/en/updates/2015_february/</guid><description>Github: fidm
Commit: init</description></item><item><title>November 2014</title><link>https://dopos.github.io/en/updates/2014_november/</link><pubDate>Wed, 12 Nov 2014 00:00:00 +0000</pubDate><guid>https://dopos.github.io/en/updates/2014_november/</guid><description>Github: consup
Commit: init</description></item><item><title>traefik</title><link>https://dopos.github.io/en/dcape/baseapps/traefik/</link><pubDate>Thu, 30 Jan 2020 00:38:25 +0900</pubDate><guid>https://dopos.github.io/en/dcape/baseapps/traefik/</guid><description>Конфигурация traefik Использование TLS Dcape поддерживает протокол TLS с использованием ключей Let&amp;rsquo;s Encrypt.
При инициализации Dcape, поддержку TLS можно сконфигурировать четырьмя способами:
local mode - локальная установка, использование DCAPE на локальном компьютере без поддержки TLS. dev mode - установка с использованием TLS с отдельным сертификатом для каждого приложения, использование которых настраивается конкретно для приложения при его развертывании. По умолчанию включено для встроенных приложений dcape (cis, portainer, gitea). В этом режиме используется переменная REDIR_ENTRY, которой устанавливается редирект на https отдельно для каждого приложения.</description></item><item><title>Applications</title><link>https://dopos.github.io/en/dcape/usage/apps/</link><pubDate>Tue, 28 Jan 2020 00:36:14 +0900</pubDate><guid>https://dopos.github.io/en/dcape/usage/apps/</guid><description>Introduction Dcape v2 предназначен для построения gitops (CI/CD) решений, в которых на каждом сервере установлен dcape и на одном - web-сервис git (например: gitea), который по факту изменений в репозитории активирует drone на присоединенных серверах.
После развёртывания сервисов git/drone, задача dcape уже решена, но возникает возможность добавить в деплой:
docker-compose.yml Makefile Эти файлы добавляются в образ dcape-compose, поэтому доступны и на хостовой системе и при развёртывании. Для работы с ними в Makefile приложения надо добавить директивы:</description></item><item><title>Назначение</title><link>https://dopos.github.io/en/dcape/purpose/</link><pubDate>Tue, 28 Jan 2020 00:34:51 +0900</pubDate><guid>https://dopos.github.io/en/dcape/purpose/</guid><description>Зачем это нужно Цель создания dcape - получить относительно удобный способ запуска docker-приложений простой короткой командой, например
make up - локально git push - удаленно Главная проблема была в том, как повесить несколько контейнеров на порт 80, чтобы запросы к ним проксировались по имени хоста не на основании заранее руками созданного конфига, а по факту старта контейнера - эту задачу решил traefik.
Бонусом он добавил TLS, т.е. возможность получения сертификата для хоста или, когда хостов много - для домена (т.</description></item><item><title>PostgreSQL</title><link>https://dopos.github.io/en/dcape/baseapps/postgresql/</link><pubDate>Thu, 30 Jan 2020 00:38:25 +0900</pubDate><guid>https://dopos.github.io/en/dcape/baseapps/postgresql/</guid><description/></item><item><title>Updates</title><link>https://dopos.github.io/en/dcape/usage/update/</link><pubDate>Tue, 28 Jan 2020 00:39:06 +0900</pubDate><guid>https://dopos.github.io/en/dcape/usage/update/</guid><description>Если dcape был установлен командой git clone, для его обновления используется команда git pull, после выполнения которой необходимо обновить файл .env
Обновление файла .env При обновлении проекта возможно появление новых переменных в .env файле.
Алгоритм обновления .env с сохранением старых настроек:
1 2 mv .env .env.bak make init Другой вариант:
1 2 mv .env .env.1019 make init CFG_BAK=.env.1019 Все совпадающие значения будут взяты из .</description></item><item><title>Quick Start</title><link>https://dopos.github.io/en/dcape/gettingstarted/quickstart/</link><pubDate>Tue, 28 Jan 2020 00:34:41 +0900</pubDate><guid>https://dopos.github.io/en/dcape/gettingstarted/quickstart/</guid><description>Интернет-сервер без gitea Вариант c поддержкой wildcard-сертификатов SSL, при котором gitea установлена на другом сервере (в примере - it.domain.tld) и уже создан TOKEN. Настройка и запуск могут быть выполнены одной командой:
1 2 3 4 5 6 7 make install ACME=wild DNS=wild DCAPE_DOMAIN=srv1.domain.tld \ TRAEFIK_ACME_EMAIL=admin@domain.tld \ NARRA_GITEA_ORG=dcape \ DRONE_ADMIN=dcapeadmin \ PDNS_LISTEN=192.168.23.10:53 \ GITEA=https://it.domain.tld \ TOKEN=**token_from_gitea** В PDNS_LISTEN порт изменен на стандартный (по умолчанию: 54) и задан ip, чтобы не возникало конфликта с локальным резолвером.</description></item><item><title>Deps</title><link>https://dopos.github.io/en/dcape/gettingstarted/dependencies/</link><pubDate>Tue, 28 Jan 2020 00:34:13 +0900</pubDate><guid>https://dopos.github.io/en/dcape/gettingstarted/dependencies/</guid><description>Зависимости linux 64bit с git, make, sed, curl, jq (тестируем на Ubuntu) docker docker-compose используется в dcape в формате docker-образа, поэтому отдельной установки не требует.
Пример установки зависимостей:
1 2 3 4 5 6 7 8 9 # docker # см https://docs.docker.com/engine/install/ubuntu/ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - sudo add-apt-repository &amp;#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs)stable&amp;#34; sudo apt install docker-ce docker-ce-cli containerd.io sudo usermod -a -G docker $USER # make git sed curl jq sudo apt install make git sed curl jq</description></item><item><title>gitea</title><link>https://dopos.github.io/en/dcape/baseapps/gitea/</link><pubDate>Thu, 30 Jan 2020 00:38:25 +0900</pubDate><guid>https://dopos.github.io/en/dcape/baseapps/gitea/</guid><description/></item><item><title>DNS setup</title><link>https://dopos.github.io/en/dcape/gettingstarted/dns/</link><pubDate>Tue, 28 Jan 2020 00:34:13 +0900</pubDate><guid>https://dopos.github.io/en/dcape/gettingstarted/dns/</guid><description>DNS Т.к. dcape разворачивает несколько независимых сервисов, их имена должны быть прописаны в DNS. Предпочтительным является вариант регистрации wildcard domain, но можно и регистрировать индивидуально.
Пример имен для сервера srv1.domain.tld:
srv1.domain.tld - для фронтендов narra, enfist, traefik git.srv1.domain.tld - для gitea drone.srv1.domain.tld - для drone port.srv1.domain.tld - для portainer ns.srv1.domain.tld - для powerdns См. также: DNS setup
/etc/hosts, для локального использования 1 2 3 4 5 6 7 8 9 10 11 grep -q git.</description></item><item><title>Installation</title><link>https://dopos.github.io/en/dcape/gettingstarted/installation/</link><pubDate>Tue, 28 Jan 2020 00:34:13 +0900</pubDate><guid>https://dopos.github.io/en/dcape/gettingstarted/installation/</guid><description>Исходники Рекомендуемым способом копирования файлов на сервер является выполнение git clone. Это позволяет в будущем
обновить исходники для получения информации о проверенных новых версиях используемых приложений увидеть локальные изменения исходников, если их понадобится сделать 1 2 3 4 cd /opt sudo mkdir dcape &amp;amp;&amp;amp; sudo chown $USER dcape git clone -b v2 --single-branch --depth 1 https://github.com/dopos/dcape.git cd dcape Настройка и запуск Локальный сервер Вариант без поддержки SSL, но с установкой gitea.</description></item><item><title>Configuration</title><link>https://dopos.github.io/en/dcape/gettingstarted/configuration/</link><pubDate>Tue, 28 Jan 2020 00:34:56 +0900</pubDate><guid>https://dopos.github.io/en/dcape/gettingstarted/configuration/</guid><description>Аргументы make init Благодаря использованию Makefile, любой параметр dcape может быть задан в аргументах команды make init, после выполнения которой полный список переменных с их описанием и значениями доступен в файле с именем .env (или именем, заданном в параметре CFG).
Следующие параметры имеют ключевое значение для конфигурации dcape:
DCAPE_TAG
Идентификатор стека приложений, позволяющий изолировать его от других контейнеров docker (в т.ч. и от другой копии стека dcape если такая будет запущена на том же сервере) Префикс контейнеров стека (значение используется как COMPOSE_PROJECT_NAME) DCAPE_DOMAIN</description></item><item><title>enfist</title><link>https://dopos.github.io/en/dcape/baseapps/enfist/</link><pubDate>Thu, 30 Jan 2020 00:38:25 +0900</pubDate><guid>https://dopos.github.io/en/dcape/baseapps/enfist/</guid><description/></item><item><title>narra</title><link>https://dopos.github.io/en/dcape/baseapps/narra/</link><pubDate>Thu, 30 Jan 2020 00:38:25 +0900</pubDate><guid>https://dopos.github.io/en/dcape/baseapps/narra/</guid><description/></item><item><title>Отличия dcape v2</title><link>https://dopos.github.io/en/dcape/gettingstarted/v2changes/</link><pubDate>Tue, 28 Jan 2020 00:34:41 +0900</pubDate><guid>https://dopos.github.io/en/dcape/gettingstarted/v2changes/</guid><description>Dcape v2 отличается от v1:
переездом деплоя на drone сменой версии traefik на v2. добавлением локально создаваемого образа dcape-compose Подробнее об изменениях:
Версия traefik Было: 1.7 Стало: 2.0 В результате изменились
Настройки в docker-compose Теперь для привязки настроек к контейнеру необходимо в имя добавлять уникальное имя приложения для всех приложений, работающих с одной копией traefik. Для этого добавлен параметр APP_TAG, который может быть рассчитан автоматически по hostname ресурса.</description></item><item><title>powerdns</title><link>https://dopos.github.io/en/dcape/baseapps/powerdns/</link><pubDate>Thu, 30 Jan 2020 00:38:25 +0900</pubDate><guid>https://dopos.github.io/en/dcape/baseapps/powerdns/</guid><description/></item><item><title>Portainer</title><link>https://dopos.github.io/en/dcape/baseapps/portainer/</link><pubDate>Thu, 30 Jan 2020 00:38:25 +0900</pubDate><guid>https://dopos.github.io/en/dcape/baseapps/portainer/</guid><description/></item></channel></rss>